<script>
  
// gathers all subjects from new subject list
var subjectsAPI = "http://lgapi-us.libapps.com/1.1/subjects/129750,129756,129761,129759,129758,129753,129754,129752,119567,129762,129750,129751,129760,33505,129757,129755?site_id=103&key=83d416dc1ba38e91c12fee5de29a4527";

// gathers all published guides tagged Central Indiana, includes subject expansion
var guidesAPI = "http://lgapi.libapps.com/1.1/guides/?site_id=103&key=83d416dc1ba38e91c12fee5de29a4527&expand=subjects&tag_names[]=Central%20Indiana%20Region&status[]=1&sort_by=name"


//======= multiple ways to get this done ============

// first plan: for each ID in an array of subject IDs, create a new button with name of subject and number of guides in subject tagged Central Region

    // maybe try out different versions: (see stackoverflow discussion here: https://stackoverflow.com/questions/9329446/for-each-over-an-array-in-javascript)
   
    //  1) .forEach() method    (https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach)
    //  2) for...of loop        (https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...of)
    //  3) .map() method        (https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map)
    //  4) .filter() method     (https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter)
    
    // might need to use the push method...
      
      // iterate through the guides object, pulling out unique subject names and pushing to empty array
          // how to pull out unique subjects? $.inArray()? .indexOf()? https://stackoverflow.com/questions/32742504/push-object-to-array-when-unique
              
              // var subjects = [];
              // if (subjectIDs.indexOf( guide.subjects[0].id ) === -1) {
                  // this method returns -1 if the thing you're checking for doesn't exist in the array, i.e. has no index position (less than zero)
              //   push to the array!
              // } else {
              //   skip it, yo
              // }
            
              // this has to be close, but double check docs: https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf
              
              
      // then iterate through new array to create buttons/links


// START HERE ===========================

//global variables

  var subjectIDs = [129750,129756,129761,129759,129758,129753,129754,129752,119567,129762,129750,129751,129760,33505,129757,129755];
  var subjectString = subjectIDs.toString();
  var subjectSlug = `&subject_ids=${subjectString}`;
  var subjectIDsAPI = `http://lgapi.libapps.com/1.1/guides/?site_id=103&key=83d416dc1ba38e91c12fee5de29a4527${subjectSlug}&expand=subjects&tag_names[]=Central%20Indiana%20Region&status[]=1&sort_by=name`;
  
// ===== lodash methods =====================
  
 
  
  $.getJSON(subjectIDsAPI, function(data) {

      // create empty array where objects {guide: xyz, subject: xyz} will go
    	var guideSubjectArray =[];
       
      // for each object in the JSON file
      data.forEach(function(guide) {
        
            // create empty object for pushing into array
          	  var nameSubjectObj = {};
          	  
          	  // create empty array for pushing subjects to
          	  var subjects = [];
              
          	  // set object key/values
              nameSubjectObj["name"] = guide.name;
          	  nameSubjectObj["subject"] = subjects;
          	  
          	  //new crazy shit
          	  // somewhere in here needs to be an if statement to the effect of:
          	      // if (_.includes(subjectIDs, ID#)) push name to subjects array
          	      
          	  for (let item of guide.subjects) {
            
            			for (let key in item) {
            				 
            				if (key == "name") {
            					subjects.push(item[key]);
                                
                             }
                        }
            				// console.log(item);
                    }
                     
                    
             
              
              // take object full of name/subject key/value pairs and push it to the guide-subject array
              guideSubjectArray.push(nameSubjectObj);
              console.log(nameSubjectObj);
      
      })
    
  
        // create arrays to 1) sort subjects alphabetically, and 2) hold guide count by subject
      	var sortedArray = _.orderBy(guideSubjectArray, "subject", "asc");
      	var uniqueArray = _.countBy(sortedArray, "subject");
      	
      	// create counter for panel accordion collapse action
      	var panelCounter = 0;
      	
      	//create tile for each subject  (includes count of guides in subject)
      	//when tile clicked, reveal list of guides; when clicked again, list disappears (accordion panel style)
      	 var subjectList = `<div class="panel-group" id="accordion">`;
	 
      	//loop through subjects and count and create list items
      	_.forEach(uniqueArray, function(count, subject) {
      	   
            subjectList += `<div class="panel panel-default">
                              <div class="panel-heading">
                                <h5 class="panel-title">
                                  <a data-toggle="collapse" data-parent="#accordion" data-target="#collapse${panelCounter}" aria-expanded="false">
                                    ${subject}<span class="badge badge-default badge-pill">${count}</span>
                                  </a>
                                </h5>
                              </div>
                              <div id="collapse${panelCounter}" class="panel-collapse collapse">
                                <div class="panel-body">
                                <ul>`
                                  
                                  
                                  _.forEach(data, function(guide) {
                                      
                                      if (subject === guide.subjects[0].name) {
                                        
                                        subjectList += `<li><a href="${guide.friendly_url}">${guide.name}</a></li>`;
                                      }
                                    
                                  })
                                  
                                  
            subjectList+=       `</ul>
                                </div>
                              </div>
                            </div>`
             
            panelCounter += 1;
        });
  
        subjectList += `</div>`;
        
      	
      	$('#published-guides').empty();
        $('#published-guides').append(subjectList);
    
  });


// 3.1) get rid of "central indiana" in guide titles
// 5) might want to do a "for...of" loop for iterating through subjects in each guide: https://stackoverflow.com/questions/11922383/access-process-nested-objects-arrays-or-json
/// 5a) IF it matches one of the subject IDs, then display
/// 5b) figure out how to access nested anonymous objects... for each loop?? i.e. for (const subject of data.subjects)

  
</script>
