<script>

//based on the portal's "moreStruggling.html" version of the google calendar api call
//see this code in action on central indiana website's hidden page "Hours (google api)"
//requires lodash.js and moments.js

//calendar address: 6kuplvcd1jd17s8fjlm2ohad0s@group.calendar.google.com
//key (as of 3/30/17): AIzaSyCW8BnWqQ2Cytq6K0mZ9K2nomEc8jwzK-4

const date = moment();
const today = date.format("dddd, MMMM D, YYYY");

$('#todays-date').append(today);

const utc = date.toJSON().slice(0,10);

const googleCal = `https://www.googleapis.com/calendar/v3/calendars/6kuplvcd1jd17s8fjlm2ohad0s@group.calendar.google.com/events?singleEvents=true&timeMin=${utc}T00:00:00-04:00&timeMax=${utc}T23:59:59-04:00&key=AIzaSyCW8BnWqQ2Cytq6K0mZ9K2nomEc8jwzK-4`


const displaySchedule = (data) => {
 
        
        //returns an array that holds all calendar data for specific day
        const libraries = _.filter(response.responseJSON.items);
        
        
        	//sorted by reverse alphabetical order
          let sorted = _.orderBy(libraries, 'name', 'desc');
        
         //and placed in a list
         let listHTML = '<ul>';
         
          //loops through each event in the sorted libraries array (google calendar events)
          _.forEach(sorted, function(library) {
            
            //takes given time string (ISO 8601), parses it to standard format, then returns formatted time
            //i.e. "2017-03-30T21:00:00-04:00" -> "9 pm"
            function timeChanger(time) {
              const getDate = moment.parseZone(time);
              const formatDate = getDate.format("h a");
              return formatDate;
            }
            
            //setting up variables to grab start and end times from the google calendar API
            let startTime = timeChanger(library.start.dateTime);
            let endTime = timeChanger(library.end.dateTime);
  
              //so excited the ES2015 makes concatting so much easier
              //creates list item for each event in the calendar array
              //i.e. North Meridian: 8 am - 9 pm
              listHTML += `<li>${library.description}: ${startTime} - ${endTime}`;
   
          });
        
        listHTML += '</ul>';
        
        //empty old schedule list (may be unnecessary, but you never know) and replace with new list
        $('#hours-list').empty();
        $('#hours-list').append(listHTML);
        
        
          }

const response = $.getJSON(googleCal, displaySchedule);
  
</script>
